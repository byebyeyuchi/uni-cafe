{"ast":null,"code":"import _regeneratorRuntime from\"/Users/yuqiliu/Desktop/PROJECT/js-proj/jojo/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/yuqiliu/Desktop/PROJECT/js-proj/jojo/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/yuqiliu/Desktop/PROJECT/js-proj/jojo/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useReducer}from\"react\";import axios from\"axios\";import UserContext from\"./userContext\";import UserReducer from\"./UserReducer\";import{SET_CURRENT_USER,CLEAR_CURRENT_USER,UPDATE_USER,USER_ERROR,USER_RELOADED}from\"../type\";import setAuthToken from\"../../utils/setAuthToken\";var UserState=function UserState(props){var initialState={token:localStorage.getItem(\"token\"),currentUser:null,user:{},isAuthenticated:null,error:null};var _useReducer=useReducer(UserReducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];// set current user\nvar setCurrentUser=function setCurrentUser(user){dispatch({type:SET_CURRENT_USER,payload:user});};// clear current user\nvar clearCurrentUser=function clearCurrentUser(){dispatch({type:CLEAR_CURRENT_USER});};// update user\nvar updateUser=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(currentUser,user){var config,res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:config={headers:{\"Content-Type\":\"application/json\"}};_context.prev=1;_context.next=4;return axios.put(\"/api/users/\".concat(currentUser._id),user,config);case 4:res=_context.sent;dispatch({type:UPDATE_USER,payload:res.data});reloadUser();_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](1);dispatch({type:USER_ERROR,payload:_context.t0.response.msg});case 12:case\"end\":return _context.stop();}}},_callee,null,[[1,9]]);}));return function updateUser(_x,_x2){return _ref.apply(this,arguments);};}();// reload user\nvar reloadUser=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(localStorage.token){setAuthToken(localStorage.token);}_context2.prev=1;_context2.next=4;return axios.get(\"/api/auth\");case 4:res=_context2.sent;dispatch({type:USER_RELOADED,payload:res.data});_context2.next=11;break;case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](1);dispatch({type:USER_ERROR,payload:_context2.t0.response.data.msg});case 11:case\"end\":return _context2.stop();}}},_callee2,null,[[1,8]]);}));return function reloadUser(){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/React.createElement(UserContext.Provider,{value:{user:state.user,token:state.token,currentUser:state.currentUser,isAuthenticated:state.isAuthenticated,loading:state.loading,error:state.error,setCurrentUser:setCurrentUser,clearCurrentUser:clearCurrentUser,updateUser:updateUser,reloadUser:reloadUser}},props.children);};export default UserState;","map":{"version":3,"sources":["/Users/yuqiliu/Desktop/PROJECT/js-proj/jojo/client/src/context/user/UserState.js"],"names":["React","useReducer","axios","UserContext","UserReducer","SET_CURRENT_USER","CLEAR_CURRENT_USER","UPDATE_USER","USER_ERROR","USER_RELOADED","setAuthToken","UserState","props","initialState","token","localStorage","getItem","currentUser","user","isAuthenticated","error","state","dispatch","setCurrentUser","type","payload","clearCurrentUser","updateUser","config","headers","put","_id","res","data","reloadUser","response","msg","get","loading","children"],"mappings":"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","sourcesContent":["\nimport React, { useReducer } from \"react\";\nimport axios from \"axios\";\nimport UserContext from \"./userContext\";\nimport UserReducer from \"./UserReducer\";\nimport {\n   SET_CURRENT_USER,\n   CLEAR_CURRENT_USER,\n   UPDATE_USER,\n   USER_ERROR,\n   USER_RELOADED\n} from \"../type\";\nimport setAuthToken from \"../../utils/setAuthToken\";\n\nconst UserState = (props) => {\n   const initialState = {\n      token: localStorage.getItem(\"token\"),\n      currentUser: null,\n      user: {},\n      isAuthenticated: null,\n      error: null,\n   };\n   const [state, dispatch] = useReducer(UserReducer, initialState);\n\n   // set current user\n   const setCurrentUser = (user) => {\n      dispatch({\n         type: SET_CURRENT_USER,\n         payload: user\n      });\n   };\n\n   // clear current user\n   const clearCurrentUser = () => {\n      dispatch({ type: CLEAR_CURRENT_USER });\n   };\n\n   // update user\n   const updateUser = async (currentUser, user) => {\n      const config = {\n         headers: {\n            \"Content-Type\": \"application/json\",\n         },\n      };\n      try {\n         const res = await axios.put(`/api/users/${currentUser._id}`, user, config);\n         dispatch({\n            type: UPDATE_USER,\n            payload: res.data,\n         });\n         reloadUser();\n      } catch (err) {\n         dispatch({\n            type: USER_ERROR,\n            payload: err.response.msg,\n         });\n      }\n   };\n\n   // reload user\n   const reloadUser = async () => {\n    if(localStorage.token){\n       setAuthToken(localStorage.token);\n    }  \n    try {\n       const res = await axios.get(\"/api/auth\");\n       dispatch({ type: USER_RELOADED, payload: res.data });\n    } catch (err) {\n       dispatch({ type: USER_ERROR, payload: err.response.data.msg});\n    }\n };\n\n\n   return (\n      <UserContext.Provider\n         value={{\n            user: state.user,\n            token: state.token,\n            currentUser: state.currentUser,\n            isAuthenticated: state.isAuthenticated,\n            loading: state.loading,\n            error: state.error,\n            setCurrentUser,\n            clearCurrentUser,\n            updateUser,\n            reloadUser\n         }}\n      >\n         {props.children}\n      </UserContext.Provider>\n   );\n};\n\nexport default UserState;\n"]},"metadata":{},"sourceType":"module"}