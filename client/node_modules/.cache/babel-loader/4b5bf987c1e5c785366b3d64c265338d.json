{"ast":null,"code":"import _regeneratorRuntime from\"/Users/yuqiliu/Desktop/jojo/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/yuqiliu/Desktop/jojo/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/yuqiliu/Desktop/jojo/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useReducer,useContext}from\"react\";import axios from\"axios\";import AuthContext from\"./authContext\";import authReducer from\"./authReducer\";import{REGISTER_SUCCESS,REGISTER_FAIL,USER_LOADED,AUTH_ERROR,LOGIN_SUCCESS,LOGIN_FAIL,LOGOUT,CLEAR_ERRORS}from\"../type\";import setAuthToken from'../../utils/setAuthToken';var AuthState=function AuthState(props){var initialState={token:localStorage.getItem(\"token\"),user:null,isAuthenticated:null,loading:true,error:null};var _useReducer=useReducer(authReducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];// load user\nvar loadUser=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(localStorage.token){setAuthToken(localStorage.token);}_context.prev=1;_context.next=4;return axios.get(\"/api/auth\");case 4:res=_context.sent;dispatch({type:USER_LOADED,payload:res.data});_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](1);dispatch({type:AUTH_ERROR,payload:_context.t0.response.data.msg});case 11:case\"end\":return _context.stop();}}},_callee,null,[[1,8]]);}));return function loadUser(){return _ref.apply(this,arguments);};}();// register user\nvar register=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(formData){var config,res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:config={headers:{\"Content-Type\":\"application/json\"}};_context2.prev=1;_context2.next=4;return axios.post(\"/api/users\",formData,config);case 4:res=_context2.sent;dispatch({type:REGISTER_SUCCESS,payload:res.data// token returned if success\n});loadUser();_context2.next=12;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](1);dispatch({type:REGISTER_FAIL,payload:_context2.t0.response.data.msg});case 12:case\"end\":return _context2.stop();}}},_callee2,null,[[1,9]]);}));return function register(_x){return _ref2.apply(this,arguments);};}();// login user\nvar login=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(formData){var config,res;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:config={headers:{\"Content-Type\":\"application/json\"}};_context3.prev=1;_context3.next=4;return axios.post(\"/api/auth\",formData,config);case 4:res=_context3.sent;dispatch({type:LOGIN_SUCCESS,payload:res.data// token returned if success\n});loadUser();_context3.next=12;break;case 9:_context3.prev=9;_context3.t0=_context3[\"catch\"](1);dispatch({type:LOGIN_FAIL,payload:_context3.t0.response.data.msg});case 12:case\"end\":return _context3.stop();}}},_callee3,null,[[1,9]]);}));return function login(_x2){return _ref3.apply(this,arguments);};}();// logout user\nvar logout=function logout(){localStorage.removeItem('token');setAuthToken(null);dispatch({type:LOGOUT});};// clear error\nvar clearErrors=function clearErrors(){return dispatch({type:CLEAR_ERRORS});};return/*#__PURE__*/React.createElement(AuthContext.Provider,{value:{token:state.token,isAuthenticated:state.isAuthenticated,loading:state.loading,error:state.error,user:state.user,register:register,loadUser:loadUser,login:login,logout:logout,clearErrors:clearErrors}},props.children);};export default AuthState;","map":{"version":3,"sources":["/Users/yuqiliu/Desktop/jojo/client/src/context/auth/AuthState.js"],"names":["React","useReducer","useContext","axios","AuthContext","authReducer","REGISTER_SUCCESS","REGISTER_FAIL","USER_LOADED","AUTH_ERROR","LOGIN_SUCCESS","LOGIN_FAIL","LOGOUT","CLEAR_ERRORS","setAuthToken","AuthState","props","initialState","token","localStorage","getItem","user","isAuthenticated","loading","error","state","dispatch","loadUser","get","res","type","payload","data","response","msg","register","formData","config","headers","post","login","logout","removeItem","clearErrors","children"],"mappings":"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","sourcesContent":["import React, { useReducer, useContext } from \"react\";\nimport axios from \"axios\";\nimport AuthContext from \"./authContext\";\nimport authReducer from \"./authReducer\";\nimport {\n   REGISTER_SUCCESS,\n   REGISTER_FAIL,\n   USER_LOADED,\n   AUTH_ERROR,\n   LOGIN_SUCCESS,\n   LOGIN_FAIL,\n   LOGOUT,\n   CLEAR_ERRORS,\n} from \"../type\";\nimport setAuthToken from '../../utils/setAuthToken';\n\n\nconst AuthState = (props) => {\n   const initialState = {\n      token: localStorage.getItem(\"token\"),\n      user: null,\n      isAuthenticated: null,\n      loading: true,\n      error: null,\n   };\n   const [state, dispatch] = useReducer(authReducer, initialState);\n\n   // load user\n   const loadUser = async () => {\n      if(localStorage.token){\n         setAuthToken(localStorage.token);\n      }  \n      try {\n         const res = await axios.get(\"/api/auth\");\n         dispatch({ type: USER_LOADED, payload: res.data });\n      } catch (err) {\n         dispatch({ type: AUTH_ERROR, payload: err.response.data.msg});\n      }\n   };\n\n   // register user\n   const register = async (formData) => {\n      const config = {\n         headers: {\n            \"Content-Type\": \"application/json\",\n         },\n      };\n      try {\n         const res = await axios.post(\"/api/users\", formData, config);\n         dispatch({\n            type: REGISTER_SUCCESS,\n            payload: res.data, // token returned if success\n         });\n         loadUser();\n      } catch (err) {\n         dispatch({\n            type: REGISTER_FAIL,\n            payload: err.response.data.msg,\n         });\n      }\n   };\n\n   // login user\n   const login = async (formData) => {\n      const config = {\n         headers: {\n            \"Content-Type\": \"application/json\",\n         },\n      };\n      try {\n         const res = await axios.post(\"/api/auth\", formData, config);\n         dispatch({\n            type: LOGIN_SUCCESS,\n            payload: res.data, // token returned if success\n         });\n         loadUser();\n      } catch (err) {\n         dispatch({\n            type: LOGIN_FAIL,\n            payload: err.response.data.msg,\n         });\n      }\n   };\n\n   // logout user\n   const logout = () => {\n      localStorage.removeItem('token');\n      setAuthToken(null);\n      dispatch({type: LOGOUT})\n   };\n   \n\n   // clear error\n   const clearErrors = () => dispatch({ type: CLEAR_ERRORS });\n\n   return (\n      <AuthContext.Provider\n         value={{\n            token: state.token,\n            isAuthenticated: state.isAuthenticated,\n            loading: state.loading,\n            error: state.error,\n            user: state.user,\n            register,\n            loadUser,\n            login,\n            logout,\n            clearErrors,\n         }}\n      >\n         {props.children}\n      </AuthContext.Provider>\n   );\n};\nexport default AuthState;\n"]},"metadata":{},"sourceType":"module"}